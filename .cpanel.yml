---
deployment:
  tasks:
    - export DEPLOYPATH=/home/marddium/public_html
    - export REPOPATH=/home/marddium/repositories/stellar-seo-website-design
    - echo "ğŸš€ Starting deployment from $REPOPATH to $DEPLOYPATH"
    - echo "ğŸ”§ PRE-DEPLOYMENT: Working from repository directory..."
    - cd $REPOPATH
    - pwd
    - echo "ğŸ“Š Git status before cleanup:"
    - git status
    - echo "ğŸ§¹ Stashing any local changes..."
    - git stash push -u -m "Auto-stash before deployment $(date)" || true
    - echo "ğŸ”„ Ensuring we're on main branch..."
    - git checkout main
    - echo "â¬‡ï¸ Fetching latest from GitHub..."
    - git fetch origin main
    - echo "ğŸ”¨ Hard reset to match GitHub exactly..."
    - git reset --hard origin/main
    - echo "ğŸ§½ Cleaning any remaining untracked files..."
    - git clean -fd
    - echo "âœ… Repository sync completed!"
    - echo "ğŸ“‹ Current commit after reset:"
    - git log --oneline -1
    - echo "ğŸ“ Checking dist folder exists and has content:"
    - ls -la $REPOPATH/dist/ || echo "âš ï¸ dist folder not found!"
    - echo "ğŸ—‚ï¸ Checking what's currently in web directory:"
    - ls -la $DEPLOYPATH/
    - echo "ğŸš€ Copying files from $REPOPATH/dist/ to $DEPLOYPATH/"
    - /bin/cp -R $REPOPATH/dist/* $DEPLOYPATH/
    - echo "ğŸ” Setting proper permissions..."
    - /bin/find $DEPLOYPATH -type d -exec chmod 755 {} \; 2>/dev/null || true
    - /bin/find $DEPLOYPATH -type f -exec chmod 644 {} \; 2>/dev/null || true
    - echo "âœ… Verifying critical files deployed:"
    - ls -la $DEPLOYPATH/index.html || echo "âŒ index.html missing!"
    - ls -la $DEPLOYPATH/sitemap.xml || echo "âŒ sitemap.xml missing!"
    - ls -la $DEPLOYPATH/robots.txt || echo "âŒ robots.txt missing!"
    - echo "ğŸ‰ Deployment completed successfully!"
    - echo "ğŸŒ Website should be live at https://mardenseo.com"
    - echo "ğŸ• Deployment time: $(date)"