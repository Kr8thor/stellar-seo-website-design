---
deployment:
  tasks:
    # Set up logging
    - export LOGFILE=/home/marddium/deployment-debug.log
    - echo "=== DIRECT DEPLOYMENT $(date) ===" > $LOGFILE
    
    # We're already in public_html, so work from current directory
    - echo "üîç CURRENT DIRECTORY:" | tee -a $LOGFILE
    - pwd | tee -a $LOGFILE
    - whoami | tee -a $LOGFILE
    
    # Check if Node.js is available
    - echo "üîß CHECKING DEPENDENCIES:" | tee -a $LOGFILE
    - node --version 2>&1 | tee -a $LOGFILE || echo "‚ùå Node.js not available" | tee -a $LOGFILE
    - npm --version 2>&1 | tee -a $LOGFILE || echo "‚ùå NPM not available" | tee -a $LOGFILE
    
    # Install dependencies if package.json exists
    - echo "üì¶ INSTALLING DEPENDENCIES:" | tee -a $LOGFILE
    - test -f package.json && npm install 2>&1 | tee -a $LOGFILE || echo "‚ö†Ô∏è No package.json found" | tee -a $LOGFILE
    
    # Build the project if build script exists
    - echo "üèóÔ∏è BUILDING PROJECT:" | tee -a $LOGFILE
    - test -f package.json && npm run build 2>&1 | tee -a $LOGFILE || echo "‚ö†Ô∏è No build script available" | tee -a $LOGFILE
    
    # Move built files to root if dist folder exists
    - echo "üìÅ MOVING BUILT FILES:" | tee -a $LOGFILE
    - if test -d dist; then echo "Moving dist contents to web root..." | tee -a $LOGFILE && cp -R dist/* . 2>&1 | tee -a $LOGFILE && echo "‚úÖ Files moved to web root" | tee -a $LOGFILE; else echo "‚ö†Ô∏è No dist folder found, using source files directly" | tee -a $LOGFILE; fi
    
    # Clean up development files (keep built files only)
    - echo "üßπ CLEANING DEVELOPMENT FILES:" | tee -a $LOGFILE
    - rm -rf src/ node_modules/ dist/ *.md *.json *.js *.ts *.config.* .git* .env* 2>&1 | tee -a $LOGFILE || echo "‚ö†Ô∏è Cleanup completed with warnings" | tee -a $LOGFILE
    
    # Set proper permissions
    - echo "üîê SETTING PERMISSIONS:" | tee -a $LOGFILE
    - find . -type d -exec chmod 755 {} \; 2>&1 | tee -a $LOGFILE
    - find . -type f -exec chmod 644 {} \; 2>&1 | tee -a $LOGFILE
    
    # Verify deployment
    - echo "‚úÖ VERIFYING DEPLOYMENT:" | tee -a $LOGFILE
    - test -f index.html && echo "‚úÖ index.html exists" | tee -a $LOGFILE || echo "‚ùå index.html missing" | tee -a $LOGFILE
    - test -f sitemap.xml && echo "‚úÖ sitemap.xml exists" | tee -a $LOGFILE || echo "‚ö†Ô∏è sitemap.xml missing" | tee -a $LOGFILE
    - test -f robots.txt && echo "‚úÖ robots.txt exists" | tee -a $LOGFILE || echo "‚ö†Ô∏è robots.txt missing" | tee -a $LOGFILE
    - ls -la | tee -a $LOGFILE
    
    # Final status
    - echo "üéâ DIRECT DEPLOYMENT COMPLETED!" | tee -a $LOGFILE
    - echo "üåê Website: https://mardenseo.com" | tee -a $LOGFILE
    - echo "üìã Log: /home/marddium/deployment-debug.log" | tee -a $LOGFILE